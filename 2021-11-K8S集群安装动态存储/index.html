<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>K8S集群安装动态存储 GlusterFS - 操先森的博客</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="操先森的博客"><meta name="msapplication-TileImage" content="/images/logo.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="操先森的博客"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="K8S 存储介绍 简介在 K8S 中，对容器所应用的存储资源抽象为存储卷 Volume。它的生命周期与 POD 相同，POD 中的容器如果要使用某个 Volume，需要通过 volumeMounts来指定某个 volume 或者 多个 volume 挂载到容器的目录或文件。那么就可以从容器中访问 volume 中的数据。 K8S支持内部资源对象类型、开源共享存储类型等，K8S管理宿主机的本地存储类"><meta property="og:type" content="blog"><meta property="og:title" content="K8S集群安装动态存储 GlusterFS"><meta property="og:url" content="https://caolizhi.top/2021-11-K8S%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8/"><meta property="og:site_name" content="操先森的博客"><meta property="og:description" content="K8S 存储介绍 简介在 K8S 中，对容器所应用的存储资源抽象为存储卷 Volume。它的生命周期与 POD 相同，POD 中的容器如果要使用某个 Volume，需要通过 volumeMounts来指定某个 volume 或者 多个 volume 挂载到容器的目录或文件。那么就可以从容器中访问 volume 中的数据。 K8S支持内部资源对象类型、开源共享存储类型等，K8S管理宿主机的本地存储类"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://caolizhi.top/images/og_image.png"><meta property="article:published_time" content="2021-11-02T05:50:14.000Z"><meta property="article:modified_time" content="2021-11-03T03:31:14.000Z"><meta property="article:author" content="操先森"><meta property="article:tag" content="K8S"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/images/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://caolizhi.top/2021-11-K8S%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8/"},"headline":"K8S集群安装动态存储 GlusterFS","image":["https://caolizhi.top/images/og_image.png"],"datePublished":"2021-11-02T05:50:14.000Z","dateModified":"2021-11-03T03:31:14.000Z","author":{"@type":"Person","name":"操先森"},"publisher":{"@type":"Organization","name":"操先森的博客","logo":{"@type":"ImageObject","url":"https://caolizhi.top/images/logo.svg"}},"description":"K8S 存储介绍 简介在 K8S 中，对容器所应用的存储资源抽象为存储卷 Volume。它的生命周期与 POD 相同，POD 中的容器如果要使用某个 Volume，需要通过 volumeMounts来指定某个 volume 或者 多个 volume 挂载到容器的目录或文件。那么就可以从容器中访问 volume 中的数据。 K8S支持内部资源对象类型、开源共享存储类型等，K8S管理宿主机的本地存储类"}</script><link rel="canonical" href="https://caolizhi.top/2021-11-K8S%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8/"><link rel="icon" href="/images/logo.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?c2c31a128dbe61bc1214fcf1f334afd1";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-210020245-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-210020245-1');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/logo.svg" alt="操先森的博客" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/caolizhi"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-11-02T05:50:14.000Z" title="2021/11/2 下午1:50:14">2021-11-02</time>发表</span><span class="level-item"><time dateTime="2021-11-03T03:31:14.000Z" title="2021/11/3 上午11:31:14">2021-11-03</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span><span class="level-item">21 分钟读完 (大约3079个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">K8S集群安装动态存储 GlusterFS</h1><div class="content"><h2 id="K8S-存储介绍"><a href="#K8S-存储介绍" class="headerlink" title="K8S 存储介绍"></a>K8S 存储介绍</h2><ul>
<li><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>在 K8S 中，对容器所应用的存储资源抽象为存储卷 Volume。它的生命周期与 POD 相同，POD 中的容器如果要使用某个 Volume，需要通过 <code>volumeMounts</code>来指定某个 volume 或者 多个 volume 挂载到容器的目录或文件。那么就可以从容器中访问 volume 中的数据。</p>
<p>K8S支持内部资源对象类型、开源共享存储类型等，K8S管理宿主机的本地存储类型， <code>EmptyDir</code> 和 <code>HostPath</code>，前者为临时目录，后者为宿主机目录。内部资源对象最常见的就是持久化存储 PV，开源共享存储类型就有很多，比如：</p>
<ul>
<li>CephFS 开源共享存储系统</li>
<li>Glusterfs 开源共享存储系统</li>
<li>CSI（Container Storage Interface，容器存储接口）由存储提供商提供驱动程序和管理程序</li>
<li>FlexVolume 一种基于插件式驱动的存储</li>
<li>其他</li>
</ul>
<blockquote>
<p><code>EmptyDir</code> 是在 pod 被调度到 node 时创建，在初始状态下目录中是空的，与 pod 的生命周期相同。</p>
</blockquote>
</li>
</ul>
<span id="more"></span>

<ul>
<li><h3 id="持久卷"><a href="#持久卷" class="headerlink" title="持久卷"></a>持久卷</h3><p>K8S 通过 Persistent Volume(PV) 和 Persistent Volume Claim(PVC) 两个资源对象来管理存储的资源。这样做的好处是屏蔽了对底层存储的实现细节。PV 是对存储资源的一种抽象，PV 是由管理员创建和配置的，与具体的厂商有关。<strong>PV 的生命周期与 POD 的生命周期分开的。</strong></p>
<p>PVC 是对 PV 资源的一种申请。但是 PVC 无法表明哪种存储是什么样的特性，应用程序会根据自己的特点去选择相应的存储资源，包括读写的速度啊，并发性能等。 K8S 引入了一个新的资源对象 <code>StorageClass</code> 用来标记存储资源的特点和性能，动态选择合适的 PV 资源。管理员通过 <code>StorageClass</code> 来定义存储资源的 profile，然后应用程序根据自己的需求去申请相应的存储资源就可以了。  </p>
<p>另外从 1.9 版本开始，K8S 引入了 CSI 机制，就是提供了一个借口，具体实现由各自存储厂商实现，解耦存储相关的代码，之前的存储代码是内嵌的，必须要修改代码才能提供相应的存储资源。</p>
<p>pod 通过 <code>persistentVolumeClaim</code> 使用PVC，会通过定义的 StorageClass 来动态绑定需要使用的存储类型，如果没有 PV，那么 PVC 会处在 <code>Pending</code> 的状态， 删除 PVC 时，只有与其绑定的 POD 删除时，才会删除，删除 PV 时，只有与其绑定的 PVC 删除了才会被删除。PVC 和 PV 是一对一的绑定关系。</p>
</li>
<li><h3 id="POD-使用-PVC"><a href="#POD-使用-PVC" class="headerlink" title="POD 使用 PVC"></a>POD 使用 PVC</h3><p>系统在 pod 所在的 namespace 中找到 pod 所配置的 PVC，然后再通过 PVC 绑定 PV，将 PV 存储挂载到 pod 所在的 node 的目录下，最后再将 node 的目录挂载到 pod 的容器内。</p>
</li>
</ul>
<h2 id="GlusterFS"><a href="#GlusterFS" class="headerlink" title="GlusterFS"></a>GlusterFS</h2><ul>
<li><h3 id="安装-glusterfs"><a href="#安装-glusterfs" class="headerlink" title="安装 glusterfs"></a>安装 glusterfs</h3><p>在用于 GlusterFS 的 node 上安装 glusterfs，执行：<br><code>yum install glusterfs glusterfs-fuse</code></p>
<p>然后给相应的 node 打上一个标签，为了将 GlusterFS 容器定向部署到安装了 GlusterFS 的 node 上。执行：<br><code>kubectl label node node02 storagenode=glusterfs</code><br><code>kubectl label node node03 storagenode=glusterfs</code><br><code>kubectl label node node04 storagenode=glusterfs</code></p>
<blockquote>
<p>删除标签用命令：<code>kubectl label node &lt;node-name&gt; &lt;label-key&gt;-</code></p>
</blockquote>
</li>
<li><h3 id="创建-GlusterFS-管理服务"><a href="#创建-GlusterFS-管理服务" class="headerlink" title="创建 GlusterFS 管理服务"></a>创建 GlusterFS 管理服务</h3><p>GlusterFS 以 <code>DaemonSet</code> 方式进行部署，内容如下：</p>
<details><summary>glusterfs-daemonset.yaml</summary>

  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">glusterfs</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">glusters:</span> <span class="string">damonset</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">GlusterFS</span> <span class="string">DaemonSet</span></span><br><span class="line">    <span class="attr">tags:</span> <span class="string">glusterfs</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">glusterfs-node:</span> <span class="string">pod</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">gulsterfs</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">glusterfs-node:</span> <span class="string">pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">storagenode:</span> <span class="string">glusterfs</span></span><br><span class="line">      <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">gluster/gluster-centos:latest</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">glusterfs</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-heketi</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">&quot;/var/lib/heketi&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-run</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">&quot;/run&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-lvm</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">&quot;/run/lvm&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-etc</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">&quot;/etc/glusterfs&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-logs</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">&quot;/var/log/glusterfs&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-config</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">&quot;/var/lib/glusterd&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-dev</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">&quot;/dev&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-misc</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">&quot;/var/lib/misc/glusterfsd&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-cgroup</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">&quot;/sys/fs/cgroup&quot;</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-ssl</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">&quot;/etc/ssl&quot;</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">capabilities:</span> &#123;&#125;</span><br><span class="line">            <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">3</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">60</span></span><br><span class="line">            <span class="attr">exec:</span></span><br><span class="line">              <span class="attr">command:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&quot;/bin/bash&quot;</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&quot;-c&quot;</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">systemctl</span> <span class="string">status</span> <span class="string">glusterd.service</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">3</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">60</span></span><br><span class="line">            <span class="attr">exec:</span></span><br><span class="line">              <span class="attr">command:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&quot;/bin/bash&quot;</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&quot;-c&quot;</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">systemctl</span> <span class="string">status</span> <span class="string">glusterd.service</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-heketi</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">&quot;/var/lib/heketi&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-run</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">&quot;/run&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-lvm</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">&quot;/run/lvm&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-etc</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">&quot;/etc/glusterfs&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-logs</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">&quot;/var/log/glusterfs&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-config</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">&quot;/var/lib/glusterd&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-dev</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">&quot;/dev&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-misc</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">&quot;/var/lib/misc/glusterfsd&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-cgroup</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">&quot;/sys/fs/cgroup&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">glusterfs-ssl</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">&quot;/etc/ssl&quot;</span></span><br></pre></td></tr></table></figure>
</details>

<p>在 master 节点上执行，<code>kubectl create -f glusterfs-daemonset.yaml</code>， 然后查看是否生成资源，查看 glusterfs 的服务容器的pod：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 k8s]# kubectl get po</span><br><span class="line">NAME              READY   STATUS    RESTARTS      AGE</span><br><span class="line">glusterfs-wvlw2   1/1     Running   1 (15m ago)   20m</span><br></pre></td></tr></table></figure>
<p>然后再 describe 一下 pod，我本地有四个节点，一个master（node01），三个 worker（node02,node03，node04），worker 上都安装了 GlusterFS 服务，那么 pod <code>glusterfs-wvlw2</code> 应该只在 node03 上存在，yaml 如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 k8s]# kubectl describe pod glusterfs-wvlw2</span><br><span class="line">Name:         glusterfs-wvlw2</span><br><span class="line">Namespace:    default</span><br><span class="line">Priority:     0</span><br><span class="line">Node:         node03/192.168.170.113  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; node03 上</span><br><span class="line">Start Time:   Wed, 03 Nov 2021 15:51:21 +0800</span><br><span class="line">Labels:       controller-revision-hash=6ffb8b879</span><br><span class="line">              glusterfs-node=pod</span><br><span class="line">              pod-template-generation=1</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line">Status:       Running</span><br><span class="line">IP:           192.168.170.113</span><br><span class="line">IPs:</span><br><span class="line">  IP:           192.168.170.113</span><br></pre></td></tr></table></figure></li>
<li><h3 id="创建-Heketi-服务"><a href="#创建-Heketi-服务" class="headerlink" title="创建 Heketi 服务"></a>创建 Heketi 服务</h3><p>Heketi 提供了 RESTful API 管理 GlusterFS 卷的框架，方便对 GlusterFS 的管理。</p>
<ul>
<li><h4 id="给-Heketi-创建一个-ServiceAccount，完成-RBAC-授权"><a href="#给-Heketi-创建一个-ServiceAccount，完成-RBAC-授权" class="headerlink" title="给 Heketi 创建一个 ServiceAccount，完成 RBAC 授权"></a>给 Heketi 创建一个 ServiceAccount，完成 RBAC 授权</h4><code>kubectl create -f heketi-rbac.yaml</code>，yaml 内容如下：<details>
    <summary>heketi-rbac.yaml</summary>
    <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">heketi-service-account</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">heketi</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">          <span class="attr">verbs:</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">	   <span class="string">watch</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="string">endpoints</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="string">services</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">          <span class="attr">verbs:</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="string">pods/exec</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">heketi</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">heketi</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">heketi-service-account</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">default</span></span><br></pre></td></tr></table></figure>
</details></li>
<li><h4 id="部署-heketi-服务"><a href="#部署-heketi-服务" class="headerlink" title="部署 heketi 服务"></a>部署 heketi 服务</h4><code>kubectl create -f heketi-deployment-svc.yaml</code>，yaml 内容如下：<details>
    <summary>heketi-deployment-svc.yaml</summary>
     <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">         # heketi-deployment-svc.yaml</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: heketi</span><br><span class="line">  labels:</span><br><span class="line">    glusterfs: heketi-deployment</span><br><span class="line">    deploy-heketi: heketi-deployment</span><br><span class="line">  annotations:</span><br><span class="line">    description: Defines how to deploy Heketi</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      name: deploy-heketi</span><br><span class="line">      glusterfs: heketi-pod</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: deploy-heketi</span><br><span class="line">      labels:</span><br><span class="line">        name: deploy-heketi</span><br><span class="line">        glusterfs: heketi-pod</span><br><span class="line">    spec:</span><br><span class="line">      serviceAccountName: heketi-service-account</span><br><span class="line">      containers:</span><br><span class="line">        - image: heketi/heketi</span><br><span class="line">          name: deploy-heketi</span><br><span class="line">          env:</span><br><span class="line">             - name: HEKETI_EXECUTOR</span><br><span class="line">            value: kubernetes</span><br><span class="line">          - name: HEKETI_FSTAB</span><br><span class="line">                     value: &quot;/var/lib/heketi/fstab&quot;</span><br><span class="line">                   - name: HEKETI_SNAPSHOT_LIMIT</span><br><span class="line">            value: &quot;14&quot;</span><br><span class="line">          - name: HEKETI_KUBE_GLUSTER_DAEMONSET</span><br><span class="line">                     value: &quot;y&quot;</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 8080</span><br><span class="line">          volumeMounts:</span><br><span class="line">            - mountPath: &quot;/var/lib/heketi&quot;</span><br><span class="line">              name: db</span><br><span class="line">          readinessProbe:</span><br><span class="line">            timeoutSeconds: 3</span><br><span class="line">            initialDelaySeconds: 3</span><br><span class="line">            httpGet:</span><br><span class="line">              port: 8080</span><br><span class="line">              path: &quot;/hello&quot;</span><br><span class="line">          livenessProbe:</span><br><span class="line">            timeoutSeconds: 3</span><br><span class="line">            initialDelaySeconds: 3</span><br><span class="line">            httpGet:</span><br><span class="line">              port: 8080</span><br><span class="line">              path: &quot;/hello&quot;</span><br><span class="line">      volumes:</span><br><span class="line">        - name: db</span><br><span class="line">          hostPath:</span><br><span class="line">            path: &quot;/heketi-datae&quot;</span><br><span class="line">---</span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: heketi</span><br><span class="line">  labels:</span><br><span class="line">    glusterfs: heketi-service</span><br><span class="line">    deploy-heketi: support</span><br><span class="line">  annotations:</span><br><span class="line">    description: Expose Heketi Service</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    name: deploy-heketi</span><br><span class="line">  ports:</span><br><span class="line">    - port: 8080</span><br><span class="line">      targetPort: 8080</span><br><span class="line">      name: deploy-heketi</span><br></pre></td></tr></table></figure>
</details>
  </li>
</ul>
</li>
<li><h3 id="通过-Heketi-管理-GlusterFS-集群"><a href="#通过-Heketi-管理-GlusterFS-集群" class="headerlink" title="通过 Heketi 管理 GlusterFS 集群"></a>通过 Heketi 管理 GlusterFS 集群</h3><p>在使用 Heketi 之前，需要配置文件来表明 GlusterFS 集群的信息，用 topology.json 来表示，如下所示。<br>其中 <code>manage</code> 表示主机名，<code>storage</code> 表示 IP， <code>devices</code> 表示未创建文件系统的裸磁盘（<font color=blue>可以关闭虚拟机，然后设置虚拟机，增加一块磁盘，打开虚拟机之后，<code>lsblk</code>， 就能看到 <code>/dev/sdb</code> 的磁盘</font>），这样 Heketi 自动完成 PV（Physical Volume）、VG（Volume Group）和 LV（Logical Volume）的创建。</p>
<details><summary>topology.json</summary>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">   &#123;</span><br><span class="line">  <span class="attr">&quot;clusters&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;nodes&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;node&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;hostnames&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;manage&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;node02&quot;</span></span><br><span class="line">              ],</span><br><span class="line">              <span class="attr">&quot;storage&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;192.168.170.112&quot;</span></span><br><span class="line">              ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;zone&quot;</span>: <span class="number">1</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;devices&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;/dev/sdb&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;node&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;hostnames&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;manage&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;node03&quot;</span></span><br><span class="line">              ],</span><br><span class="line">              <span class="attr">&quot;storage&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;192.168.170.113&quot;</span></span><br><span class="line">              ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;zone&quot;</span>: <span class="number">1</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;devices&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;/dev/sdb&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;node&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;hostnames&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;manage&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;node04&quot;</span></span><br><span class="line">              ],</span><br><span class="line">              <span class="attr">&quot;storage&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;192.168.170.114&quot;</span></span><br><span class="line">              ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;zone&quot;</span>: <span class="number">1</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;devices&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;/dev/sdb&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</details>

<p><strong>进入到 Heketi 容器</strong>，使用 Heketi-cli 执行命令创建<br><code>kubectl exec -it heketi-c7cbcd99f-5fr87 -- /bin/bash</code>，创建上面的 topology.json 文件，然后执行命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"> [root@heketi-c7cbcd99f-5fr87 /]# export HEKETI_CLI_SERVER=http://localhost:8080</span><br><span class="line"> [root@heketi-c7cbcd99f-5fr87 /]# heketi-cli -s $HEKETI_CLI_SERVER --user admin --secret &#x27;My Secret&#x27; topology load --json=topology.json</span><br><span class="line"> [root@heketi-c7cbcd99f-5fr87 /]# heketi-cli topology load --json=topology.json </span><br><span class="line"> Creating cluster ... ID: a1960a285b7314517477b178f4babbcc</span><br><span class="line">Allowing file volumes on cluster.</span><br><span class="line">Allowing block volumes on cluster.</span><br><span class="line">Creating node node02 ... ID: 9b6fa5213ef920f428a60bd199456c5a</span><br><span class="line">	Adding device /dev/sdb ... OK</span><br><span class="line">Creating node node03 ... ID: 54abf4963294de9bec989f5b641fa1e2</span><br><span class="line">	Adding device /dev/sdb ... OK</span><br><span class="line">Creating node node04 ... ID: d8573f0c2506db8cca6c0cfeb86f4ac8</span><br><span class="line">	Adding device /dev/sdb ... OK</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果直接执行命令 <code>heketi-cli topology load --json=topology.json</code> 会出现一下错误：<br><code>Error: Unable to get topology information: Invalid JWT token: Token missing iss claim</code><br>需要加上 user 和 secret，可以从 <code>/etc/heketi/heketi.json</code> 文件中拿到值。<br>也可以先加入环境变量，然后就可以直接执行：<code>heketi-cli topology load --json=topology.json</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export HEKETI_CLI_USER=admin</span><br><span class="line">export HEKETI_CLI_SERVER=http://localhost:8080</span><br><span class="line">export HEKETI_CLI_KEY=My\ Secret</span><br></pre></td></tr></table></figure>
</blockquote>
<p>查看 Heketi 创建的 topology 的信息，执行命令：<br><code>heketi-cli topology --user admin --secret &#39;My Secret&#39; info</code></p>
<details><summary>Heteki 的 topology 信息</summary>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[root@heketi-c7cbcd99f-5fr87 /]# heketi-cli topology --user admin --secret &#x27;My Secret&#x27; info</span><br><span class="line"></span><br><span class="line">   [root@heketi-c7cbcd99f-5fr87 /]# heketi-cli topology info</span><br><span class="line"></span><br><span class="line">Cluster Id: a1960a285b7314517477b178f4babbcc</span><br><span class="line"></span><br><span class="line">    File:  true</span><br><span class="line">    Block: true</span><br><span class="line"></span><br><span class="line">    Volumes:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Nodes:</span><br><span class="line"></span><br><span class="line">        Node Id: 54abf4963294de9bec989f5b641fa1e2</span><br><span class="line">        State: online</span><br><span class="line">        Cluster Id: a1960a285b7314517477b178f4babbcc</span><br><span class="line">        Zone: 1</span><br><span class="line">        Management Hostnames: node03</span><br><span class="line">        Storage Hostnames: 192.168.170.113</span><br><span class="line">        Devices:</span><br><span class="line">                Id:28b4f9a350aff4c88ab7ffcab79764eb   State:online    Size (GiB):19      Used (GiB):1       Free (GiB):18      </span><br><span class="line">                        Known Paths: /dev/disk/by-path/pci-0000:00:10.0-scsi-0:0:1:0 /dev/sdb</span><br><span class="line"></span><br><span class="line">                        Bricks:</span><br><span class="line"></span><br><span class="line">        Node Id: 9b6fa5213ef920f428a60bd199456c5a</span><br><span class="line">        State: online</span><br><span class="line">        Cluster Id: a1960a285b7314517477b178f4babbcc</span><br><span class="line">        Zone: 1</span><br><span class="line">        Management Hostnames: node02</span><br><span class="line">        Storage Hostnames: 192.168.170.112</span><br><span class="line">        Devices:</span><br><span class="line">                Id:54d66971acb11982b48dcbccf6d2e29c   State:online    Size (GiB):19      Used (GiB):0       Free (GiB):19     </span><br><span class="line">                        Known Paths: /dev/disk/by-path/pci-0000:00:10.0-scsi-0:0:1:0 /dev/sdb</span><br><span class="line"></span><br><span class="line">                        Bricks:</span><br><span class="line"></span><br><span class="line">        Node Id: d8573f0c2506db8cca6c0cfeb86f4ac8</span><br><span class="line">        State: online</span><br><span class="line">        Cluster Id: a1960a285b7314517477b178f4babbcc</span><br><span class="line">        Zone: 1</span><br><span class="line">        Management Hostnames: node04</span><br><span class="line">        Storage Hostnames: 192.168.170.114</span><br><span class="line">        Devices:</span><br><span class="line">                Id:c49d4d978b189c2347778e72b411d52d   State:online    Size (GiB):19      Used (GiB):0       Free (GiB):19     </span><br><span class="line">                        Known Paths: /dev/disk/by-path/pci-0000:00:10.0-scsi-0:0:1:0 /dev/sdb</span><br><span class="line"></span><br><span class="line">                        Bricks:</span><br></pre></td></tr></table></figure>
</details>
  
<p>上面的信息可以看到，磁盘的大小，剩余空间，但是 GlusterFS 的 Volume 和 Brick 还没有创建。</p>
<blockquote>
<p>关于 GlusterFS 中的一些术语：</p>
<ul>
<li>Brick: GlusterFS 的最小存储单元，表示授信存储吃里面的导出目录，格式：<code>SERVER:EXPORT</code>，比如：<code>node02:/exports/data/</code></li>
<li>Volume: 一组 Bricks 的逻辑集合  </li>
</ul>
</blockquote>
</li>
<li><h3 id="定义-StorageClass"><a href="#定义-StorageClass" class="headerlink" title="定义 StorageClass"></a>定义 StorageClass</h3><p>定义个 StorageClass，来使用和配置 GlusterFS 提供的存储。内容如下：</p>
<figure class="highlight yaml"><figcaption><span>storageclass-gluster-heketi.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">gluster-heketi</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">kubernetes.io/glusterfs</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">resturl:</span> <span class="string">&quot;http://10.100.161.204:8080&quot;</span></span><br><span class="line">  <span class="attr">restauthenabled:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">  <span class="attr">restuser:</span> <span class="string">&quot;admin&quot;</span></span><br><span class="line">  <span class="attr">secretNamespace:</span> <span class="string">&quot;default&quot;</span></span><br><span class="line">  <span class="attr">secretName:</span> <span class="string">&quot;heketi-secret&quot;</span></span><br></pre></td></tr></table></figure>
<p>在 master 上执行创建命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 k8s]# kubectl create -f storageclass-gluster-heketi.yaml</span><br><span class="line">storageclass.storage.k8s.io/gluster-heketi created</span><br><span class="line">[root@node01 k8s]# kubectl get sc</span><br><span class="line">NAME             PROVISIONER               RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br><span class="line">gluster-heketi   kubernetes.io/glusterfs   Delete          Immediate           false                  15s</span><br></pre></td></tr></table></figure>

<p>上面的 SC 中，还需要定义一个 secret 来授权访问 Heketi 的 API，不然调用 <code>POST /Volume</code> 会报错。<code>heketi-secret.yaml</code> 定义如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">heketi-secret</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">key:</span> <span class="string">TXkgU2VjcmV0</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">kubernetes.io/glusterfs</span>  <span class="comment"># 必须定义</span></span><br></pre></td></tr></table></figure></li>
<li><h2 id="定义-PVC"><a href="#定义-PVC" class="headerlink" title="定义 PVC"></a>定义 PVC</h2><p>通过上面的步骤，我们已经准备好了 PV，现在可以定义一个 PVC 来申请使用 PV 中的资源。定义一个 PVC：</p>
<figure class="highlight yaml"><figcaption><span>pvc-gluster-heketi.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pvc-gluster-heketi</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">gluster-heketi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">1Gi</span></span><br></pre></td></tr></table></figure>
<p>上面的定义中，没有定义 <code>selector</code> 属性，使用动态资源供应模式。创建过程的日志可以通过跟踪 Heketi pod 的日志。<code>kubectl logs -f heketi-c7cbcd99f-xc774</code><br><img src="/2021-11-K8S%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8/heketi-create-volume.png" alt="heketi创建 volume 日志过程.png"></p>
<p>创建 PVC 成功后，再看看其状态，已经是 <code>Bound</code> 状态：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 k8s]# kubectl get pvc</span><br><span class="line">NAME                 STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS     AGE</span><br><span class="line">pvc-gluster-heketi   Bound    pvc-990850cc-5d60-4ef5-9315-7318645a83f8   1Gi        RWO            gluster-heketi   16s</span><br></pre></td></tr></table></figure>
<p>查看 PV，可以看到，PVC 申请 PV 之后，heketi 创建一个 volume，然后将 volume 和 PV 绑定，并且是一对一的关系。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 k8s]# kubectl get pv</span><br><span class="line">NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                        STORAGECLASS     REASON   AGE</span><br><span class="line">pvc-990850cc-5d60-4ef5-9315-7318645a83f8   1Gi        RWO            Delete           Bound    default/pvc-gluster-heketi   gluster-heketi            8m2s</span><br></pre></td></tr></table></figure>
<p>describe 一下这个 PV，看到里面的状态、 StorageClass 以及容量等信息，还有一些 GlusterFS 的配置，heketi 也帮助我们完成了。看到 annotation 的描述，<strong>“Dynamically provisioned PV”</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 k8s]# kubectl describe pv pvc-990850cc-5d60-4ef5-9315-7318645a83f8</span><br><span class="line">Name:            pvc-990850cc-5d60-4ef5-9315-7318645a83f8</span><br><span class="line">Labels:          &lt;none&gt;</span><br><span class="line">Annotations:     Description: Gluster-Internal: Dynamically provisioned PV</span><br><span class="line">gluster.kubernetes.io/heketi-volume-id: 9b6067dbcd842dd55d998c5641c6ab7d</span><br><span class="line">gluster.org/type: file</span><br><span class="line">kubernetes.io/createdby: heketi-dynamic-provisioner</span><br><span class="line">pv.beta.kubernetes.io/gid: 2000</span><br><span class="line">pv.kubernetes.io/bound-by-controller: yes</span><br><span class="line">pv.kubernetes.io/provisioned-by: kubernetes.io/glusterfs</span><br><span class="line">Finalizers:      [kubernetes.io/pv-protection]</span><br><span class="line">StorageClass:    gluster-heketi</span><br><span class="line">Status:          Bound</span><br><span class="line">Claim:           default/pvc-gluster-heketi</span><br><span class="line">Reclaim Policy:  Delete</span><br><span class="line">Access Modes:    RWO</span><br><span class="line">VolumeMode:      Filesystem</span><br><span class="line">Capacity:        1Gi</span><br><span class="line">Node Affinity:   &lt;none&gt;</span><br><span class="line">Message:         </span><br><span class="line">Source:</span><br><span class="line">Type:                Glusterfs (a Glusterfs mount on the host that shares a pod&#x27;s lifetime)</span><br><span class="line">EndpointsName:       glusterfs-dynamic-990850cc-5d60-4ef5-9315-7318645a83f8</span><br><span class="line">EndpointsNamespace:  default</span><br><span class="line">Path:                vol_9b6067dbcd842dd55d998c5641c6ab7d</span><br><span class="line">ReadOnly:            false</span><br><span class="line">Events:                  &lt;none&gt;</span><br></pre></td></tr></table></figure>
<p>通过以上的操作，一个真正 PVC 就生成了，挂载到 pod 里面就可以使用了。</p>
</li>
<li><h2 id="pod-使用-PVC"><a href="#pod-使用-PVC" class="headerlink" title="pod 使用 PVC"></a>pod 使用 PVC</h2><p>通过一个简单的 nginx pod 来使用 PVC，使用 <code>persistentVolumeClaim</code> 来挂载 PVC。另外，<strong>pod 和 PVC 要在同一个 namespace 中才能使用。</strong> 比较简单，不展开了。</p>
</li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>K8S集群安装动态存储 GlusterFS</p><p><a href="https://caolizhi.top/2021-11-K8S集群安装动态存储/">https://caolizhi.top/2021-11-K8S集群安装动态存储/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>操先森</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-11-02</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-11-03</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/K8S/">K8S</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=6164f650ea6eca00151d8d08&amp;product=inline-share-buttons" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/images/wechat_pay.jpg" alt="微信"></span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/images/alipay.jpg" alt="支付宝"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021-11-%E4%BD%BF%E7%94%A8Kubeadm%E5%B7%A5%E5%85%B7%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85K8S%E9%9B%86%E7%BE%A4/"><span class="level-item">使用Kubeadm工具快速安装K8S集群</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "2471b54b72d8f92738c29f786b170ef5",
            repo: "caolizhi.github.io",
            owner: "caolizhi",
            clientID: "a494d62f203aa8c7e2e2",
            clientSecret: "7114657b7a13cc18ec25989917c5d2de0de93f5c",
            admin: ["caolizhi"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 10,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/images/avatar.png" alt="操先森"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">操先森</p><p class="is-size-6 is-block">Java Engineer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>四川·成都</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">18</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">9</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">13</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/caolizhi" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/caolizhi"><i class="fab fa-github"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#K8S-存储介绍"><span class="level-left"><span class="level-item">1</span><span class="level-item">K8S 存储介绍</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#简介"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">简介</span></span></a></li><li><a class="level is-mobile" href="#持久卷"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">持久卷</span></span></a></li><li><a class="level is-mobile" href="#POD-使用-PVC"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">POD 使用 PVC</span></span></a></li></ul></li><li><a class="level is-mobile" href="#GlusterFS"><span class="level-left"><span class="level-item">2</span><span class="level-item">GlusterFS</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#安装-glusterfs"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">安装 glusterfs</span></span></a></li><li><a class="level is-mobile" href="#创建-GlusterFS-管理服务"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">创建 GlusterFS 管理服务</span></span></a></li><li><a class="level is-mobile" href="#创建-Heketi-服务"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">创建 Heketi 服务</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#给-Heketi-创建一个-ServiceAccount，完成-RBAC-授权"><span class="level-left"><span class="level-item">2.3.1</span><span class="level-item">给 Heketi 创建一个 ServiceAccount，完成 RBAC 授权</span></span></a></li><li><a class="level is-mobile" href="#部署-heketi-服务"><span class="level-left"><span class="level-item">2.3.2</span><span class="level-item">部署 heketi 服务</span></span></a></li></ul></li><li><a class="level is-mobile" href="#通过-Heketi-管理-GlusterFS-集群"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">通过 Heketi 管理 GlusterFS 集群</span></span></a></li><li><a class="level is-mobile" href="#定义-StorageClass"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">定义 StorageClass</span></span></a></li></ul></li><li><a class="level is-mobile" href="#定义-PVC"><span class="level-left"><span class="level-item">3</span><span class="level-item">定义 PVC</span></span></a></li><li><a class="level is-mobile" href="#pod-使用-PVC"><span class="level-left"><span class="level-item">4</span><span class="level-item">pod 使用 PVC</span></span></a></li></ul></div></div><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Java/"><span class="level-start"><span class="level-item">Java</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/Java/%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/"><span class="level-start"><span class="level-item">内存模型</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"><span class="level-start"><span class="level-item">多线程</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/"><span class="level-start"><span class="level-item">云原生</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">响应式编程</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%AE%B9%E5%99%A8%E4%BA%91/"><span class="level-start"><span class="level-item">容器云</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="level-start"><span class="level-item">数据库</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">网络编程</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-11-02T05:50:14.000Z">2021-11-02</time></p><p class="title"><a href="/2021-11-K8S%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E5%8A%A8%E6%80%81%E5%AD%98%E5%82%A8/">K8S集群安装动态存储 GlusterFS</a></p><p class="categories"><a href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-11-01T08:54:17.000Z">2021-11-01</time></p><p class="title"><a href="/2021-11-%E4%BD%BF%E7%94%A8Kubeadm%E5%B7%A5%E5%85%B7%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85K8S%E9%9B%86%E7%BE%A4/">使用Kubeadm工具快速安装K8S集群</a></p><p class="categories"><a href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-10-29T08:51:43.000Z">2021-10-29</time></p><p class="title"><a href="/2021-10-JVM%E7%B3%BB%E5%88%97-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">JVM 系列 ———— JVM 基础</a></p><p class="categories"><a href="/categories/Java/">Java</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-10-26T06:48:48.000Z">2021-10-26</time></p><p class="title"><a href="/2021-10-VMwarePro16%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9/">VMware PRO 16 配置共享文件夹</a></p><p class="categories"><a href="/categories/Linux/">Linux</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-10-26T06:22:33.000Z">2021-10-26</time></p><p class="title"><a href="/2021-10-VMwarePro16%E5%A4%8D%E5%88%B6%E8%99%9A%E6%8B%9F%E6%9C%BA/">VMware PRO 16 复制虚拟机</a></p><p class="categories"><a href="/categories/Linux/">Linux</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/09/"><span class="level-start"><span class="level-item">九月 2021</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/AQS/"><span class="tag">AQS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CAS/"><span class="tag">CAS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/I-O/"><span class="tag">I/O</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JUC/"><span class="tag">JUC</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JVM/"><span class="tag">JVM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/K8S/"><span class="tag">K8S</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql/"><span class="tag">mysql</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reactive/"><span class="tag">reactive</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/web/"><span class="tag">web</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"><span class="tag">线程池</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/"><span class="tag">虚拟机</span><span class="tag">3</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/logo.svg" alt="操先森的博客" height="28"></a><p class="is-size-7"><span>&copy; 2021 操先森</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/caolizhi"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>